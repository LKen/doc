[TOC]

## web实现位置和路线显示

① 参数补全                                             ok
② 位置信息修复                                      ok
③ 根据机器人列表 模拟数据切换清除数据   ok
④ 尝试根据异步请求获取数据                     ok

-  初始获取 initData()

   -   获取机器人定位 getStatus()
       -   获取地图资源数据，			初始化地图
           -   获取路线  getLineInfo()
               -   根据需要更新路线 updateLineInfo()
                   -   第一次 || 不是第一次而且不同于原来的  getLineInfo()
                       -   清空路线
                       -   重置定位坐标
                       -   更新路线
                   -   else 不做操作
           -   在路线绘制成功后，实现定位坐标 updateStatus()
               -   原来的定位出现问题，不能最高显示
               -   而且图标不能随地图放大而缩小
               -   所以采用 imageMarker 来做
                   -   判断是否存在
                       -   更新位置 
                       -   创建新的定位marker
-  再次获取  initData()


- 差异
  - 蜂鸟地图base 
    - 取消标注点击弹窗
    - 循环getStatus
    - 循环获取路线
    - 取消地图信息框
  - 动作地图
    - 拥有标注点击弹框
    - 不循环获取status
    - 循环获取路线信息
    - 地图信息框

## 地图动作编辑

- 点击拉起dialog
  - 根据路线ID 来 调起dialog 而不是根据机器人正在的路线
    - 分两种情况
      - 在请求路线信息前，input#lineCode 是不为空的，success 后 不重新赋值
      - 在请求路线信息前，input#lineCode 是为空的，success 后 重新赋值请求到的lineCode
- 显示可切换的 tab window 【标志的属性】
- 根据标志的属性加载相应的方法 -- 先弹出  再初始化
- 切换到其他地图
  - 退出前清除内容
- 切换到蜂鸟地图 -- 触发条件 点击tab按钮
- 实现单例模式，不行就只创建一次，
  - 实现数据获取 -- 触发 循环机制
    - 退出时关闭循环获取数据 
    - 清空地图图层信息 layer marker

      ​
- 动作编辑
  - 点击标注弹窗  （右上角图标 -> 可点击）
    - 拉起dialog 完成后续封装好的功能

## 蜂鸟地图坐标标定功能

1. 根据bootstrap row  获取id   【判断】
2. 若是没有mapdata 就弹出编辑框，填写信息；
3. 图片固定（缩放比例）
4. 蜂鸟地图旋转（旋转角度） 缩放（缩放比例）不可3D
5. 蜂鸟坐标
6. 屏幕坐标
7. 激光图片对应的坐标
8. 实际激光图片
9. 删除标注提示


- 问题
  - fengMap coord  => screen coordinates  （这个屏幕坐标对应范围的是 `div#fengMap` BoundingClinetRect 区域，以左上角为**零点**）
    - 经过移动，同一个蜂鸟坐标   !=  屏幕坐标

  - screen coordinates => fengMap coord
    - 经过移动，同一个屏幕坐标对应不同的蜂鸟坐标
    - 经过缩放，屏幕中心点坐标对应不同的蜂鸟坐标


- 根据不同的row 数据，加载对应的地图资源，以及对应 的激光地图url
  > ```js
  > {
  > deviceId:8834,
  > id:105,
  > mapName:"bigmap",
  > mapPicUrl:"http://192.168.41.50:8080/webdav/1.png",
  > picHeight:1024,
  > picWidth:704
  > }
  > ```

# 蜂鸟地图代码整理

### 需求分析

1. 实时（单机器人）

   >   *生成地图*
   >   1. 点击根据侧拉栏获取 id  
   >   2. 根据id 获取机器人状态 [在线 \ 离线]，在线 （转3），离线（转6）
   >   3. 在线：根据当前的lineCode， id 获取路线信息 （无信息，转6）√
   >   4. 更新路线信息 √
   >   5. 统一绘制，图层（统一清除，统一绘制） √
   >   6. 统一错误处理 √


   > ​

1. 显示路线（单机器人对应的路线）

   >*生成地图*
   >
   >1. 点击根据 **表格行数据** 获取 id，lineCode，获取路线信息（无信息，转5）√
   >2. 更新路线信息 √
   >3. 统一绘制，图层（统一清除，统一绘制，根据需要添加气泡） √
   >4. 添加动作编辑
   >   1. 添加气泡
   >5. 统一错误处理 √